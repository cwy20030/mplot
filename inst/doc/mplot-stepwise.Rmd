---
title: "When stepwise fails"
author: "Garth Tarr"
date: "24 July 2014"
output: html_document
---

<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{A brief introduction to mplot}
-->

# When stepwise fails

The deficiencies of stepwise procedures are well known.  This document illustrates an example where stepwise variable selection procedures fall victim to local minimia and highlights the utility of the various procedures and plots provided by the `mplot` package.

To begin consider the following data set inspired by the `pathoeg` data set in the `MVP` package.

```{r}
n=50
set.seed(8)
x1 = rnorm(n,0.22,2)
x7 = 0.5*x1 + rnorm(n,0,sd=2)
x6 = -0.75*x1 + rnorm(n,0,3)
x3 = -0.5-0.5*x6 + rnorm(n,0,2)
x9 = rnorm(n,0.6,3.5)
x4 = 0.5*x9 + rnorm(n,0,sd=3)
x2 = -0.5 + 0.5*x9 + rnorm(n,0,sd=2)
x5 = -0.5*x2+0.5*x3+0.5*x6-0.5*x9+rnorm(n,0,1.5)
x8 = x1 + x2 -2*x3 - 0.3*x4 + x5 - 1.6*x6 - 1*x7 + x9 +rnorm(n,0,0.5)
y = 0.6*x8 + rnorm(n,0,2)
df = round(data.frame(x1,x2,x3,x4,x5,x6,x7,x8,x9,y),1)
```

When looking at the pairs plot and correlation matrix, there is nothing particularly unusual that stands out about this data set:

```{r}
round(cor(df),1)
plot(df)
```

We can fit the full model and perform the default stepwise variable selection.

```{r}
mf = lm(y~.,data=df)
summary(mf)
mf.step=step(mf)
summary(mf.step)
```

It is clear that using the basic stepwise variable selection yields a highly non-parsimonious model.  In fact it has removed `x8` which was the only variable that `y` was directly constructed from in the data generating process.

```{r, results='asis', tidy=FALSE}
require(mplot)
af1 = af(mf)
op = options(gvis.plot.tag = "chart")
plot(af1)
```

Also could look at the variable importance plots:

```{r vip, results='asis', tidy=FALSE}
vis1 = vis(mf)
plot(vis1,which="vip")
```

And the model selection curves:

```{r lvk, results='asis', tidy=FALSE}
plot(vis1,which="lvk")
```

```{r boot, results='asis', tidy=FALSE}
plot(vis1,which="boot")
```

To interact with the plots in the graphical user interface, use:

```{r, eval=FALSE}
mplot(mf, vis=vis1, af=af1)
```