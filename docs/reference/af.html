<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>The adaptive fence procedure — af • mplot</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="The adaptive fence procedure — af" />
<meta property="og:description" content="This function implements the adaptive fence procedure to
first find the optimal cstar value and then finds the
corresponding best model as described in Jiang et. al.
(2009) with some practical modifications." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mplot</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Theory
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/background.html">Background and philosophy</a>
    </li>
    <li>
      <a href="../articles/vip.html">Variable inclusion plots</a>
    </li>
    <li>
      <a href="../articles/msp.html">Model stability plots</a>
    </li>
    <li>
      <a href="../articles/af.html">Adaptive fence</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Applications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/publications.html">Publications</a>
    </li>
    <li>
      <a href="../articles/diabetes.html">Diabetes</a>
    </li>
    <li>
      <a href="../articles/birthweight.html">Birth weight</a>
    </li>
    <li>
      <a href="../articles/artificial.html">Artificial example</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tips
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/interactive.html">Interactive plots</a>
    </li>
    <li>
      <a href="../articles/timing.html">Timing</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/garthtarr/mplot">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/people.html">
    <span class="fa fa-info-circle fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>The adaptive fence procedure</h1>
    <small class="dont-index">Source: <a href='https://github.com/garthtarr/mplot/blob/master/R/af.R'><code>R/af.R</code></a></small>
    <div class="hidden name"><code>af.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function implements the adaptive fence procedure to
first find the optimal cstar value and then finds the
corresponding best model as described in Jiang et. al.
(2009) with some practical modifications.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>af</span><span class='op'>(</span>
  <span class='va'>mf</span>,
  B <span class='op'>=</span> <span class='fl'>60</span>,
  n.c <span class='op'>=</span> <span class='fl'>20</span>,
  initial.stepwise <span class='op'>=</span> <span class='cn'>FALSE</span>,
  force.in <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>cores</span>,
  <span class='va'>nvmax</span>,
  <span class='va'>c.max</span>,
  screen <span class='op'>=</span> <span class='cn'>FALSE</span>,
  seed <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>mf</th>
      <td><p>a fitted 'full' model, the result of a call
to lm or glm (and in the future lme or lmer).</p></td>
    </tr>
    <tr>
      <th>B</th>
      <td><p>number of bootstrap replications at each fence
boundary value</p></td>
    </tr>
    <tr>
      <th>n.c</th>
      <td><p>number of boundary values to be considered</p></td>
    </tr>
    <tr>
      <th>initial.stepwise</th>
      <td><p>logical.  Performs an initial stepwise
procedure to look for the range of model sizes where attention
should be focussed. See details for implementation.</p></td>
    </tr>
    <tr>
      <th>force.in</th>
      <td><p>the names of variables that should be forced
into all estimated models</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>number of cores to be used when parallel
processing the bootstrap</p></td>
    </tr>
    <tr>
      <th>nvmax</th>
      <td><p>size of the largest model that can still be
considered as a viable candidate.  Included for performance
reasons but if it is an active constraint it could lead to
misleading results.</p></td>
    </tr>
    <tr>
      <th>c.max</th>
      <td><p>manually specify the upper boundary limit.
Only applies when <code>initial.stepwise=FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>screen</th>
      <td><p>logical, whether or not to perform an initial
screen for outliers.  Highly experimental, use at own risk.
Default = FALSE.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>random seed for reproducible results</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>further arguments (currently unused)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The initial stepwise procedure performs forward stepwise model
selection using the AIC and backward stepwise model selection
using BIC.  In general the backwise selection via the more
conservative BIC will tend to select a smaller model than that
of the forward selection AIC approach.  The size of these two
models is found, and we go two dimensions smaller and larger
to estimate a sensible range of <code>c</code> values over which to
perform a parametric bootstrap.</p>
<p>This procedure can take some time.  It is recommended that you start
with a relatively small number of bootstrap samples (<code>B</code>)
and grid of boundary values (<code>n.c</code>) and increase both as
required.</p>
<p>If you use <code>initial.stepwise=TRUE</code> then in general you will
need a smaller grid of boundary values than if you select
<code>initial.stepwise=FALSE</code>.
It can be useful to check <code>initial.stepwise=FALSE</code> with a
small number of bootstrap replications over a sparse grid to ensure
that the <code>initial.stepwise=TRUE</code> has landed you in a reasonable
region.</p>
<p>The <code>best.only=FALSE</code> option when plotting the results of the
adaptive fence is a modification to the adaptive fence procedure
which considers all models at a particular size that pass the fence
hurdle when calculating the p* values.  In particular,
for each value of c and at each bootstrap replication,
if a candidate model is found that passes the fence, then we look to see
if there are any other models of the same size that also pass the fence.
If no other models of the same size pass the fence, then that model is
allocated a weight of 1.  If there are two models that pass the fence, then
the best model is allocated a weight of 1/2.  If three models pass the fence,
the best model gets a weight of 1/3, and so on. After <code>B</code> bootstrap
replications, we aggregate the weights by summing over the various models.
The p* value is the maximum aggregated weight divided by the number of bootstrap
replications.
This correction penalises the probability associated with the best model if
there were other models of the same size that also passed the fence hurdle.
The rationale being that if a model has no redundant variables
then it will be the only model at that size that passes the fence over a
range of values of c.
The result is more pronounced peaks which can help to determine
the location of the correct peak and identify the optimal c*.</p>
<p>See <code><a href='plot.af.html'>?plot.af</a></code> or <code><a href='plot.af.html'>help("plot.af")</a></code> for details of the
plot method associated with the result.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Jiang J., Nguyen T., Sunil Rao J. (2009),
A simplified adaptive fence procedure, Statistics &amp;
Probability Letters, 79(5):625-629.  doi: 10.1016/j.spl.2008.10.014</p>
<p>Jiang J., Sunil Rao J., Gu Z, Nguyen T. (2008),
Fence methods for mixed model selection, Annals of Statistics,
36(4):1669-1692. doi: 10.1214/07-AOS517</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='plot.af.html'>plot.af</a></code></p>
<p>Other fence: 
<code><a href='glmfence.html'>glmfence</a>()</code>,
<code><a href='lmfence.html'>lmfence</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='va'>n</span> <span class='op'>=</span> <span class='fl'>100</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>11</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>e</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>x1</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>x2</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>x3</span> <span class='op'>=</span> <span class='va'>x1</span><span class='op'>^</span><span class='fl'>2</span></span>
<span class='r-in'><span class='va'>x4</span> <span class='op'>=</span> <span class='va'>x2</span><span class='op'>^</span><span class='fl'>2</span></span>
<span class='r-in'><span class='va'>x5</span> <span class='op'>=</span> <span class='va'>x1</span><span class='op'>*</span><span class='va'>x2</span></span>
<span class='r-in'><span class='va'>y</span> <span class='op'>=</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>x1</span> <span class='op'>+</span> <span class='va'>x2</span> <span class='op'>+</span> <span class='va'>e</span></span>
<span class='r-in'><span class='va'>dat</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>y</span>,<span class='va'>x1</span>,<span class='va'>x2</span>,<span class='va'>x3</span>,<span class='va'>x4</span>,<span class='va'>x5</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>lm1</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>dat</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># \dontshow{</span></span>
<span class='r-in'><span class='va'>af1</span> <span class='op'>=</span> <span class='fu'>af</span><span class='op'>(</span><span class='va'>lm1</span>, cores <span class='op'>=</span> <span class='fl'>1</span>, B <span class='op'>=</span> <span class='fl'>5</span>, n.c <span class='op'>=</span> <span class='fl'>5</span>, seed <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>af1</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Call:</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> af(mf = lm1, B = 5, n.c = 5, cores = 1, seed = 1)</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Adaptive fence model (c*=17.9):</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> y ~ x1 + x2</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> Model sizes considered: 1 to 7 (including intercept).</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>af1</span><span class='op'>)</span></span>
<span class='r-plt'><img src='af-1.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># }</span></span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'><span class='va'>af1</span> <span class='op'>=</span> <span class='fu'>af</span><span class='op'>(</span><span class='va'>lm1</span>, initial.stepwise <span class='op'>=</span> <span class='cn'>TRUE</span>, seed <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>af1</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>af1</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Garth Tarr, Samuel Mueller, Alan H Welsh.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


